<p>Hi guys!,</p>

<p>This is Mj0ln1r and this is my first blog, writeup and first CTF as well. All new ? haha.</p>

<p>I started learning new skills and playing CTF’s as well to gain hands on experience in the security field. Coming to this blog, its all about my solved challenges in InvaderCTF 2022.</p>

<p>InvaderCTF is a CTF competion which was organized by our collenge[RGUKTN] alumni those are working at great positions with the skills learned through CTF’s.
There is a list of categories in this CTF such as “web”, “pwn”, “reverse”, “cryptography”, and “miscellaneous”.
And i solved some challenges from each category.</p>

<p>In this post i am going to explain about the procedure i followed to solve <code class="language-plaintext highlighter-rouge">crypto</code> challenges.</p>

<h1 id="crypto-challenges">Crypto Challenges</h1>

<h2 id="commonwhat">Common….What?</h2>

<p><img src="/assets/img/post_img/common.png" alt="common_modulus" /></p>

<p>I got a file named <code class="language-plaintext highlighter-rouge">common_modulus.zip</code> it has two files <code class="language-plaintext highlighter-rouge">chall.py</code> and <code class="language-plaintext highlighter-rouge">output.txt</code>.
the <code class="language-plaintext highlighter-rouge">chall.py</code> script just prints the <code class="language-plaintext highlighter-rouge">N e1 e2 c1 c2</code> the content of <code class="language-plaintext highlighter-rouge">output.txt</code> as follows.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N = 11982945131022410542351081395449872615892579857707579658716659690935488669385262821057859182557738914580246000223393286594124225383866984597532935421878496300855873841201081561776719850279196185513497651311088240409358040299378330842236508619359647972763016690363235765860969655129269784424956130539800284778318098141912923725687592311652722505056107470370398021165270753993680221146964650298810348339426550121843506831513763524799788245715184019272818769688806186156054217173423142297185080827697102885478690188900539745266957938792259348667098941846582939290347898221569129727818304319228531810884419349788595299183
e1 = 1432834983003528423789566679766
e2 = 2379308237310255832902020443526
c1 = 10689309714150831372003282520258034721869267911572516423408248565049962108650099748793151534577215410589895845939174468496094911105822340567352621464826482784496348432260039948367408369277304473142781582593382249759117725426180831722441987089651228047819100128903524486005240635239107861739718852670683772477033147265282652735461836031051746173537294339800736436758373421135499142186805931851613817214123606130652548146050084102387221849254771049043101744791081688090961965211538682034166530987653637019819142642682927570692406882796783114872064728299928706994667553634162223654351719854271521012272876869577548029865
c2 = 10108112864771204039110360647151162379625435403389064742046377050800935678884417470071380911451172735126940164631419702014060618271946963698795724980506620687308126757038560340598588393457958478150419444430669593694549750182242922247396011389187919036956934428645928391159497083109718312975799586599853937652754710111738660741391329300491640624992257712646153846113376883043637423386066176238663086142253925553012932883285101598565990266200395298234059134450705194609356310121298248102541581987639348408092513592224044341173092657291900970886956196149689937412107716004555806327078173298630211025335704973121968612105
</code></pre></div></div>
<h4 id="what-is-common-modulus-attack">What is common modulus attack?</h4>

<p>A Common Modulus attack can be used to recover the plaintext when the same message is encrypted to two RSA keys that use the same modulus.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c1 <span class="o">=</span> m^e1 % N
c2 <span class="o">=</span> m^e2 % N
</code></pre></div></div>
<p>Assume that we find out <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> such that <code class="language-plaintext highlighter-rouge">(e1 * a) + (e2 * b) = 1</code> then we can decode the plain text as <code class="language-plaintext highlighter-rouge">(c1 ^ a) + (c2 ^ b)</code>. If we substitute how <code class="language-plaintext highlighter-rouge">c1</code> and <code class="language-plaintext highlighter-rouge">c2</code> is calculated to above equation, we can get <code class="language-plaintext highlighter-rouge">m^(e1 * a + e2 * b) = m^1 = m</code></p>

<p>The Python script to perform common modulus attack.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">utilis</span> <span class="kn">import</span> <span class="n">egcd</span><span class="p">,</span><span class="n">Convert</span>
<span class="kn">import</span> <span class="n">gmpy2</span>
<span class="kn">from</span> <span class="n">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">GCD</span>

<span class="k">def</span> <span class="nf">neg_pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="nc">GCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">gmpy2</span><span class="p">.</span><span class="nf">invert</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">common_modulus</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
	<span class="n">g</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nf">egcd</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">c1</span> <span class="o">=</span> <span class="nf">neg_pow</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">c1</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">c2</span> <span class="o">=</span> <span class="nf">neg_pow</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">c2</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
	<span class="n">ct</span> <span class="o">=</span> <span class="n">c1</span><span class="o">*</span><span class="n">c2</span> <span class="o">%</span> <span class="n">n</span>
	<span class="n">m</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">gmpy2</span><span class="p">.</span><span class="nf">iroot</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">g</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
	<span class="k">return</span> <span class="n">m</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">11982945131022410542351081395449872615892579857707579658716659690935488669385262821057859182557738914580246000223393286594124225383866984597532935421878496300855873841201081561776719850279196185513497651311088240409358040299378330842236508619359647972763016690363235765860969655129269784424956130539800284778318098141912923725687592311652722505056107470370398021165270753993680221146964650298810348339426550121843506831513763524799788245715184019272818769688806186156054217173423142297185080827697102885478690188900539745266957938792259348667098941846582939290347898221569129727818304319228531810884419349788595299183</span>
<span class="n">e1</span> <span class="o">=</span> <span class="mi">1432834983003528423789566679766</span>
<span class="n">e2</span> <span class="o">=</span> <span class="mi">2379308237310255832902020443526</span>
<span class="n">c1</span> <span class="o">=</span> <span class="mi">10689309714150831372003282520258034721869267911572516423408248565049962108650099748793151534577215410589895845939174468496094911105822340567352621464826482784496348432260039948367408369277304473142781582593382249759117725426180831722441987089651228047819100128903524486005240635239107861739718852670683772477033147265282652735461836031051746173537294339800736436758373421135499142186805931851613817214123606130652548146050084102387221849254771049043101744791081688090961965211538682034166530987653637019819142642682927570692406882796783114872064728299928706994667553634162223654351719854271521012272876869577548029865</span>
<span class="n">c2</span> <span class="o">=</span> <span class="mi">10108112864771204039110360647151162379625435403389064742046377050800935678884417470071380911451172735126940164631419702014060618271946963698795724980506620687308126757038560340598588393457958478150419444430669593694549750182242922247396011389187919036956934428645928391159497083109718312975799586599853937652754710111738660741391329300491640624992257712646153846113376883043637423386066176238663086142253925553012932883285101598565990266200395298234059134450705194609356310121298248102541581987639348408092513592224044341173092657291900970886956196149689937412107716004555806327078173298630211025335704973121968612105</span>

<span class="nc">Convert</span><span class="p">(</span><span class="nf">common_modulus</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">))</span>

</code></pre></div></div>

<blockquote>
  <p>Complete script available at <a href="https://github.com/X-Vector/X-RSA">github</a></p>
</blockquote>

<p>When i run the script with the given <code class="language-plaintext highlighter-rouge">N e1 e2 c1 c2 </code> i got the <code class="language-plaintext highlighter-rouge">flag</code>.</p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">PlainText in ascii : InvaderCTF{common_modulus_the_attack_name_is_common_modulus}</code></p>
</blockquote>

<hr />

