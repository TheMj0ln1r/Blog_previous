<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="generator" content="Jekyll">

  <title>Mj0ln1r-NullCon HackIM CTF 2023</title>
  <link rel="icon" type="image/x-icon" href="assets/img/favicons/favicon.ico">
  <link rel="stylesheet" href="/css/main.css">
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  <!-- <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" /> <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>NullCon HackIM CTF 2023 | Mj0ln1’s Blog</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="NullCon HackIM CTF 2023" />
<meta name="author" content="Mj0ln1" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Long time no see? I have been learning things in Blockchain technology in last few months. Now everything at good pace hope I can solve more CTF’s now. As comeback match, I solved this crypto challenge in NullCon HackIM CTF 2023 yesterday." />
<meta property="og:description" content="Long time no see? I have been learning things in Blockchain technology in last few months. Now everything at good pace hope I can solve more CTF’s now. As comeback match, I solved this crypto challenge in NullCon HackIM CTF 2023 yesterday." />
<link rel="canonical" href="http://localhost:4000/posts/nullconhackimctf23" />
<meta property="og:url" content="http://localhost:4000/posts/nullconhackimctf23" />
<meta property="og:site_name" content="Mj0ln1’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-20T00:00:00+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="NullCon HackIM CTF 2023" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Mj0ln1","url":"https://themj0ln1r.github.io"},"dateModified":"2023-08-20T00:00:00+05:30","datePublished":"2023-08-20T00:00:00+05:30","description":"Long time no see? I have been learning things in Blockchain technology in last few months. Now everything at good pace hope I can solve more CTF’s now. As comeback match, I solved this crypto challenge in NullCon HackIM CTF 2023 yesterday.","headline":"NullCon HackIM CTF 2023","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/nullconhackimctf23"},"url":"http://localhost:4000/posts/nullconhackimctf23"}</script>
<!-- End Jekyll SEO tag -->
 
</head>

<body>
  <div id="wrapper">
    <header>
  <div class="head-parent">
      <a href="/">
        <h1>mj0ln1r@home:~$</h1></a>
        <span id="command">cat NullCon</span>
    <div class="header-links">
      <a href="/archive"><h2 class="header-link">Archive</h2></a>
<a href="/about"><h2 class="header-link">About</h2></a>

    </div>
  </div>
</header>
    <div class="container">
      <section id="main_content">
        <article>
  <h2>NullCon HackIM CTF 2023</h2>
  <time datetime="2023-08-20T00:00:00+05:30" class="by-line">20 Aug 2023</time>
  <p>Long time no see? I have been learning things in Blockchain technology in last few months. Now everything at good pace hope I can solve more CTF’s now. As comeback match, I solved this crypto challenge in <a href="https://ctftime.org/event/2065" target="_blank">NullCon HackIM CTF 2023</a> yesterday.</p>

<h1 id="crypto---euclideanrsa">Crypto - EuclideanRSA</h1>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Attached Files : [euclidean-RSA.py, output.txt]
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">euclidean-RSA.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="n">Crypto.PublicKey</span> <span class="kn">import</span> <span class="n">RSA</span>
<span class="kn">from</span> <span class="n">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">bytes_to_long</span>
<span class="kn">from</span> <span class="n">secret</span> <span class="kn">import</span> <span class="n">flag</span><span class="p">,</span> <span class="n">magic</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="p">.</span><span class="nf">generate</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
		<span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span> <span class="o">=</span> <span class="nf">magic</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
		<span class="k">break</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="k">pass</span>
<span class="k">assert</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">==</span> <span class="n">key</span><span class="p">.</span><span class="n">n</span>
<span class="k">assert</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span> <span class="o">==</span> <span class="n">key</span><span class="p">.</span><span class="n">n</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">]:</span>
	<span class="nf">print</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="nf">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">),</span> <span class="n">key</span><span class="p">.</span><span class="n">e</span><span class="p">,</span> <span class="n">key</span><span class="p">.</span><span class="n">n</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span>

</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">output.txt</code></p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>139488614271687589953884690592970545345100917058745264617112217132329766542251923634602298183777415221556922931467521901793230800271771036880075840122128322419937786441619850848876309600263298041438727684373621920233326334840988865922273325440799379584418142760239470239003470212399313033715405566836809419407
68334789534409058399709747444525414762334123566273125910569662060699644186162637240997793681284151882169786866201685085241431171760907057806355318216602175990235605823755224694383202043476486594392938995563562039702918509120988489287149220217082428193897933957628562633459049042920472531693730366503272507672
124011822519139836919119491309637022805378274989854408578991029026928119002489232335977596528581855016599610031796540079373031282148998625318658034408770283112750172223328012238338715644743140990997114236125750813379366262418292349962679006556523851370694404238101553966330965676189731474108393418372330606063
93529593432394381438671783119087013080855868893236377597950059020717371498802208966524066540234253992421963224344343067174201693672350438201011499762718490958025617655722916641293034417795512315497126128726644064013248230211347407788186320320456853993252621916838570027019607155835349111757703654306736031792
2819638499688340337879314536945338371611392232636746056275506290935131270682791584873534866138393305591899169164183372576878693678187335219904407119253951099126339949954303448641761723704171837075206394491403411400326176280981393624784437102905397888236098861970020785226848615566768625581096019917060387964269283048823007992992874533775547300443032304973521568046956516203101626941042560505073773998143068621715480774707735064134961852206070850277695448391038882766344567740211926618750074636868149063283746597347807257171871016202588384726430246523650462866812935130465049824665395626882280287488078029119879891722

</code></pre></div></div>

<p>Observations :</p>
<ol>
  <li>The modulus(n) is written as sum of two squares in two different ways</li>
  <li>a,b,c,d values and ciphertext is given</li>
  <li><code class="language-plaintext highlighter-rouge">e</code> is not given, probably <code class="language-plaintext highlighter-rouge">65537</code></li>
</ol>

<p>After searching about <code class="language-plaintext highlighter-rouge">sum of squares as modulus in RSA</code> I found this research paper https://www.mdpi.com/2297-8747/24/2/62</p>

<p>”"”Consider a semi-prime number whose construction consists of primes \(p1,p2, N = p1p2\) , being Pythagorean,and having a representation on the Cartesian plane such that, \(p1 = x^2 + y^2\). It can easily be shown that the product of two such primes can be represented as the sum of four squares from which two sums of two squares can be derived. For such a semi-prime, if the original construction is unknown and the sum of four squares is known, the original construction \(p1,p2\) can be found.”””</p>

<p>Lets look at <code class="language-plaintext highlighter-rouge">Eulers Factorization</code></p>

<ul>
  <li><strong>A semi-prime whose prime factors are Pythagorean can be expressed as the sum of four squares, from which two sums of squares can be derived.</strong></li>
</ul>

<p>A semi-prime \(N = p1p2, p1 = a^2+b^2, p2 = c^2+d^2\) is expressed as the sum of four squares, such that:</p>

\[N=p1p2=(a^2+b^2)(c^2+d^2)=(ac)^2+(bc)^2+(ad)^2+(bd)^2\]

<p>Now in our case, \(N = (a^2+b^2)= (c^2+d^2)\). We can solve for \(p1, p2\) as follows.</p>

\[(a^2+b^2)= (c^2+d^2)\]

<p>combining odds we get,</p>

\[(a^2-c^2)= (d^2-b^2) \\
(a-c)(a+c) = (d-b)(d+b) \\

p1 = \left(\frac{gcd(a-c,d-b)}{2}\right)^2 + \left(\frac{gcd(a+c,d+b)}{2}\right)^2\\
p2 = \left(\frac{gcd(a+c,d-b)}{2}\right)^2 + \left(\frac{gcd(a-c,d+b)}{2}\right)^2\\\]

<p>Enough math, lets implement this simple math in python</p>

<p><code class="language-plaintext highlighter-rouge">solve.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">long_to_bytes</span>
<span class="kn">from</span> <span class="n">sympy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="n">math</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">139488614271687589953884690592970545345100917058745264617112217132329766542251923634602298183777415221556922931467521901793230800271771036880075840122128322419937786441619850848876309600263298041438727684373621920233326334840988865922273325440799379584418142760239470239003470212399313033715405566836809419407</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">68334789534409058399709747444525414762334123566273125910569662060699644186162637240997793681284151882169786866201685085241431171760907057806355318216602175990235605823755224694383202043476486594392938995563562039702918509120988489287149220217082428193897933957628562633459049042920472531693730366503272507672</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">124011822519139836919119491309637022805378274989854408578991029026928119002489232335977596528581855016599610031796540079373031282148998625318658034408770283112750172223328012238338715644743140990997114236125750813379366262418292349962679006556523851370694404238101553966330965676189731474108393418372330606063</span>
<span class="n">d</span> <span class="o">=</span> <span class="mi">93529593432394381438671783119087013080855868893236377597950059020717371498802208966524066540234253992421963224344343067174201693672350438201011499762718490958025617655722916641293034417795512315497126128726644064013248230211347407788186320320456853993252621916838570027019607155835349111757703654306736031792</span>
<span class="n">cipher</span> <span class="o">=</span><span class="mi">2819638499688340337879314536945338371611392232636746056275506290935131270682791584873534866138393305591899169164183372576878693678187335219904407119253951099126339949954303448641761723704171837075206394491403411400326176280981393624784437102905397888236098861970020785226848615566768625581096019917060387964269283048823007992992874533775547300443032304973521568046956516203101626941042560505073773998143068621715480774707735064134961852206070850277695448391038882766344567740211926618750074636868149063283746597347807257171871016202588384726430246523650462866812935130465049824665395626882280287488078029119879891722</span>

<span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="nf">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nf">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="n">g1</span> <span class="o">=</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> 
<span class="n">g2</span> <span class="o">=</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> 

<span class="n">p</span> <span class="o">=</span> <span class="n">g1</span><span class="o">*</span><span class="n">g1</span> <span class="o">+</span> <span class="n">g2</span><span class="o">*</span><span class="n">g2</span>

<span class="n">g1</span> <span class="o">=</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> 
<span class="n">g2</span> <span class="o">=</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> 

<span class="n">q</span> <span class="o">=</span> <span class="n">g1</span><span class="o">*</span><span class="n">g1</span> <span class="o">+</span> <span class="n">g2</span><span class="o">*</span><span class="n">g2</span>

<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="mi">65537</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nf">int</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
<span class="n">plaintext</span> <span class="o">=</span> <span class="nf">long_to_bytes</span><span class="p">(</span><span class="nf">pow</span><span class="p">(</span><span class="n">cipher</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

<span class="nf">print</span><span class="p">(</span><span class="s">"Decrypted plaintext:"</span><span class="p">,</span> <span class="n">plaintext</span><span class="p">)</span>

<span class="c1"># Output
# Decrypted plaintext: b'ENO{Gauss_t0ld_u5_th3r3_1s_mor3_th4n_on3_d1men5i0n}'
</span></code></pre></div></div>

<h1 id="crypto---sebastians-secret-sharing">Crypto - Sebastian’s Secret Sharing</h1>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Attached files : [sss.py]
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span> <span class="n">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span><span class="p">,</span><span class="n">getcontext</span>

<span class="k">class</span> <span class="nc">SeSeSe</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
		<span class="n">self</span><span class="p">.</span><span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">.</span><span class="nf">from_bytes</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">encode</span><span class="p">(),</span><span class="n">byteorder</span><span class="o">=</span><span class="s">"big"</span><span class="p">)</span>
		<span class="n">self</span><span class="p">.</span><span class="n">l</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> 	
		<span class="n">self</span><span class="p">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
		<span class="n">self</span><span class="p">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
		<span class="n">self</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_a</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">_a</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
		<span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">s</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">a</span> <span class="o">=</span> <span class="nc">Decimal</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">s</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
			<span class="n">c</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">c</span>

	<span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
		<span class="n">s</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n</span><span class="p">):</span>
			<span class="n">x</span> <span class="o">=</span> <span class="n">j</span>
			<span class="n">px</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">([</span><span class="n">self</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">t</span><span class="p">)])</span> 
			<span class="n">s</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">px</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">s</span>

	<span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">shares</span><span class="p">):</span>
		<span class="k">assert</span> <span class="nf">len</span><span class="p">(</span><span class="n">shares</span><span class="p">)</span><span class="o">==</span><span class="n">self</span><span class="p">.</span><span class="n">t</span>
		<span class="n">secret</span> <span class="o">=</span> <span class="nc">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">t</span><span class="p">):</span>
			<span class="n">yj</span> <span class="o">=</span> <span class="nc">Decimal</span><span class="p">(</span><span class="n">shares</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">r</span> <span class="o">=</span> <span class="nc">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">t</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
					<span class="k">continue</span>
				<span class="n">xm</span> <span class="o">=</span> <span class="nc">Decimal</span><span class="p">(</span><span class="n">shares</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
				<span class="n">xj</span> <span class="o">=</span> <span class="nc">Decimal</span><span class="p">(</span><span class="n">shares</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

				<span class="n">r</span> <span class="o">*=</span> <span class="nc">Decimal</span><span class="p">(</span><span class="n">xm</span><span class="o">/</span><span class="nc">Decimal</span><span class="p">(</span><span class="n">xm</span><span class="o">-</span><span class="n">xj</span><span class="p">))</span>
			<span class="n">secret</span> <span class="o">+=</span> <span class="nc">Decimal</span><span class="p">(</span><span class="n">yj</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>
		<span class="k">return</span> <span class="nf">int</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="nc">Decimal</span><span class="p">(</span><span class="n">secret</span><span class="p">),</span><span class="mi">0</span><span class="p">)).</span><span class="nf">to_bytes</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">l</span><span class="p">).</span><span class="nf">decode</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
	<span class="nf">getcontext</span><span class="p">().</span><span class="n">prec</span> <span class="o">=</span> <span class="mi">256</span> <span class="c1"># beat devision with precision :D 
</span>	<span class="n">n</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>
	<span class="n">t</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">sss</span> <span class="o">=</span> <span class="nc">SeSeSe</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="nf">open</span><span class="p">(</span><span class="s">"flag.txt"</span><span class="p">,</span><span class="s">'r'</span><span class="p">).</span><span class="nf">read</span><span class="p">(),</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
	
	<span class="n">shares</span> <span class="o">=</span> <span class="n">sss</span><span class="p">.</span><span class="nf">encode</span><span class="p">()</span>

	<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Welcome to Sebastian's Secret Sharing!"</span><span class="p">)</span>
	<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"I have split my secret into 1..N=</span><span class="si">{</span><span class="n">sss</span><span class="p">.</span><span class="n">n</span><span class="si">}</span><span class="s"> shares, and you need t=</span><span class="si">{</span><span class="n">sss</span><span class="p">.</span><span class="n">t</span><span class="si">}</span><span class="s"> shares to recover it."</span><span class="p">)</span>
	<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"However, I will only give you </span><span class="si">{</span><span class="n">sss</span><span class="p">.</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s"> shares :P"</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">sss</span><span class="p">.</span><span class="n">t</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">sid</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">.: Choose a share: "</span><span class="p">))</span>
			<span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">sid</span> <span class="o">&lt;=</span> <span class="n">sss</span><span class="p">.</span><span class="n">n</span><span class="p">:</span>
				<span class="nf">print</span><span class="p">(</span><span class="n">shares</span><span class="p">[</span><span class="n">sid</span> <span class="o">%</span> <span class="n">sss</span><span class="p">.</span><span class="n">n</span><span class="p">])</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
	<span class="nf">print</span><span class="p">(</span><span class="s">"Good luck!"</span><span class="p">)</span>
</code></pre></div></div>

<p>The remote connection of chalenge gives us the following information.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mj0ln1r@Linux:~/ nc 52.59.124.14 10031
Welcome to Sebastian<span class="s1">'s Secret Sharing!
I have split my secret into 1..N=83 shares, and you need t=10 shares to recover it.
However, I will only give you 9 shares :P
1.: Choose a share: 
</span></code></pre></div></div>

<p>I searched about secret sharing schemes available, and found that this challenge is related to <a href="https://en.wikipedia.org/wiki/Shamir%27s_secret_sharing" target="_blank">Shamir Secret Sharing</a>. I used trailofbits <a href="https://www.zkdocs.com/docs/zkdocs/protocol-primitives/shamir/" target="_blank">ZKdocs</a>to learn weaknesses in Shamir Secret Sharing.</p>

<h3 id="shamir-secret-sharing">Shamir Secret Sharing</h3>

<p>Shamir’s Secret Sharing is a cryptographic algorithm that allows you to split a secret into multiple shares in such a way that a minimum threshold of these shares is required to reconstruct the original secret. The algorithm was developed by Adi Shamir in 1979.</p>

<h4 id="step-1-choose-a-prime-number-and-parameters">Step 1: Choose a Prime Number and Parameters</h4>

<ol>
  <li>Choose a large prime number \(p\) such that \(p &gt; \text{max_secret_value}\), where \(\text{max_secret_value}\) is the maximum possible value of the secret you want to share.</li>
  <li>Choose a threshold value \((k)\), which represents the minimum number of shares required to reconstruct the secret.</li>
  <li>Choose \((k-1)\) random coefficients \((a_1, a_2, \ldots, a_{k-1})\) from the finite field \((\mathbb{F}_p)\).</li>
</ol>

<h4 id="step-2-define-the-polynomial">Step 2: Define the Polynomial</h4>

<ol>
  <li>
    <p>Construct a polynomial of degree \((k-1)\) over \((\mathbb{F}_p)\) using the chosen coefficients:</p>

\[f(x) = a_1x^{k-1} + a_2x^{k-2} + \ldots + a_{k-1}x + \text{secret}\\\]

    <p>Where:</p>
    <ul>
      <li>\((a_1, a_2, \ldots, a_{k-1})\) are the randomly chosen coefficients.</li>
      <li>\((\text{secret})\) is the value you want to share.</li>
    </ul>
  </li>
</ol>

<h4 id="step-3-generate-shares">Step 3: Generate Shares</h4>

<ol>
  <li>Choose \((k)\) distinct x-values \((x_1, x_2, \ldots, x_k)\) from the field \((\mathbb{F}_p)\).</li>
  <li>
    <p>Compute \((y_i = f(x_i))\) for each \((i)\), which represents the shares:</p>

\[y_i = a_1x_i^{k-1} + a_2x_i^{k-2} + \ldots + a_{k-1}x_i + \text{secret}\]

    <p>These \(k\) pairs \(((x_i, y_i))\) are the shares that can be distributed among participants.</p>
  </li>
</ol>

<h4 id="step-4-share-distribution">Step 4: Share Distribution</h4>

<ol>
  <li>Distribute the shares \(((x_i, y_i))\) to the participants. Each participant receives one share.</li>
</ol>

<h4 id="step-5-secret-reconstruction">Step 5: Secret Reconstruction</h4>

<ol>
  <li>
    <p>To reconstruct the secret, you need at least \((k)\) shares. Let’s say you have \((k)\) shares \(((x_1, y_1), (x_2, y_2), \ldots, (x_k, y_k))\)</p>
  </li>
  <li>
    <p>Use Lagrange interpolation to find the value of the secret:</p>

\[\text{secret} = \sum_{i=1}^{k} y_i \cdot \frac{\prod_{j=1, j\neq i}^{k} (x - x_j)}{\prod_{j=1, j\neq i}^{k} (x_i - x_j)}\]

    <p>Where:</p>
    <ul>
      <li>\((y_i)\) are the y-values of the shares.</li>
      <li>\((x_i)\) are the x-values of the shares.</li>
      <li>\((x)\) is the variable (typically set to 0).</li>
    </ul>
  </li>
</ol>

<p>By calculating this equation, you can reconstruct the original secret.</p>

<p>This is how <code class="language-plaintext highlighter-rouge">Shamir Secret Sharing</code> cryptosystem works. Coming to Challenge, we are able to get the \((k-1)\) shares of secret, but we need exactly \(k\) shares to reconstruct the secret. The secret is nothing but the \(0^{th}\) share ((0,S_0)).</p>

<p>I was not able to find the flaw in system during the CTF, after the CTF <strong><code class="language-plaintext highlighter-rouge">hakid29</code></strong> on discord helped me to find the flaw, that is, sending <code class="language-plaintext highlighter-rouge">n</code> will give us the \(0^{th}\) share which is the actual secret.</p>

<p><strong>Why sending n..?</strong></p>

<p>If we observer the following line in code,</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sid</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">input</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">.: Choose a share: "</span><span class="p">))</span>
<span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">sid</span> <span class="o">&lt;=</span> <span class="n">sss</span><span class="p">.</span><span class="n">n</span><span class="p">:</span>
	<span class="nf">print</span><span class="p">(</span><span class="n">shares</span><span class="p">[</span><span class="n">sid</span> <span class="o">%</span> <span class="n">sss</span><span class="p">.</span><span class="n">n</span><span class="p">])</span>
</code></pre></div></div>

<p>we can know that this allows us to input the any number from (1 to n) including both. So in the below line simple \(%\) operator is used to select the share among all shares. If we send <code class="language-plaintext highlighter-rouge">n</code> then it will become \(n mod n = 0\), so it will select the \(0^{th}\) share which is the flag we need.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mj0ln1r@Linux:~<span class="nv">$ </span>nc 52.59.124.14 10031
Welcome to Sebastian<span class="s1">'s Secret Sharing!
I have split my secret into 1..N=141 shares, and you need t=5 shares to recover it.
However, I will only give you 4 shares :P
1.: Choose a share: 141
(0, Decimal('</span>111370287875855598506538509804271500535681803123044982950094717<span class="s1">'))
2.: Choose a share: 
^C
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">long_to_bytes</span><span class="p">(</span><span class="mi">111370287875855598506538509804271500535681803123044982950094717</span><span class="p">))</span>

<span class="c1"># output
# b'ENO{SeCr3t_Sh4m1r_H4sh1ng}
</span></code></pre></div></div>

<blockquote>
  <p>I solved an easy web challenge too, look at this <a href="https://xhacka.github.io/posts/writeup/2023/08/20/TYPicalBoss/" target="_blank">blog</a> someone explained it better.</p>
</blockquote>

<hr />

<p>Thank you for reading!</p>

</article>
      </section>
    </div>
  </div>

   <footer>
  <a href="/">
    <span>
        <b>Mj0ln1r</b>
    </span>
    
    <span>© 2024
  </a>

  <a href="https://twitter.com/TheMj0ln1r" target="_blank">
  </span>/Twitter</span>
  </a>

  <a href="https://github.com/TheMj0ln1r" target="_blank">
  </span>/Github</span>
  </a>

  <a href="https://www.linkedin.com/in/mj0ln1r" target="_blank">
  </span>/LinkedIn</span></a>

  <a href=""><span style="color:red;">^TOP</span></a>

</footer>

  
</body>

</html>